# 利用相位平移和频率选择实现连续闪烁SSVEP-BCI的性能提升（V0.1）

## 1 为什么要做这件事

SSVEP的刺激编码一般采用正弦编码模式，也就是说刺激在屏幕上每一帧的灰度值按照一个正弦编码的序列逐帧刷新，这样的刺激诱发得到的SSVEP脑电信号呈现一个类似正弦波的波形（当然是滤波后的波形）。如果屏幕上只有一个刺激，那么看起来频率和相位不是非常重要，因为我们只需要通过分析脑电得出被试当前是否注视刺激同时是否诱发出了响应的SSVEP信号即可。

但是，如果屏幕上出现了两个刺激，我们就要考虑一个关键问题，**如何安排这两个刺激的频率和相位，使其诱发的SSVEP特征差异最大。** 较大的特征差异方便我们进行特征提取，从而判定当前用户当前在注视哪一个刺激。举一个例子：屏幕上有两个刺激，分别给他们分别赋予两组频率和相位值：8Hz,0pi；9Hz,0pi和7Hz,0pi；10Hz,1/2pi，我们可以轻松的确定，第二组频率和相位值能够带来更大的特征差异，也更易分类。

考虑刺激数量的增多，例如增到了10个，我们已经无法用经验判断到底什么样的频率组合才能得到最优的分类性能，因此就需要进行优化。选择一组合适的频率值，同时为这一组频率值选定最优的相位组合，以使之间获得更大的特征差异。

如果采用确定一组值，然后进行实验验证的方法，显然会花费大量的时间。现在我们有一个能够模拟出频率选择和相位值确定的方法，即为使用清华公开数据集仿真出一个数据集，进而验证性能。

## 2 方法

开始处理仿真数据之前，需要搞清楚一个问题，即我们使用的**范式**比较特殊，该范式移除了闪烁片段间的非刺激片段，因此刺激的闪烁是连续的，如下图所示：
![avatar](https://upload-images.jianshu.io/upload_images/19531862-9cd47d58f07ce783.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

（a）是以非刺激时间为0.4s，刺激时长为1s，刺激频率为13Hz为例的情况下的**传统**SSVEP刺激编码示意图，红色虚线标明位置表示单个试次的起始时刻。以此编码方式的SSVEP-BCI在实际工作过程中，将从红色虚线标注位置对信号进行截取，并进行特征提取及分类操作，脑-机接口每1.4s才能输出一个指令，这显然会影响脑-机接口指令输出的灵活性。
（b）为连续闪烁SSVEP的刺激编码波形。如此以来，如果每个试次均能输出一个指令，则脑-机接口的指令输出密度将会大大增加。依赖此策略，脑-机接口对外部设备的控制的灵活性将会相对提升。

为了尽可能的重构出一个**与真实数据类似的数据集**，形成一个如图（b)的可用数据体，在**清华**数据集上的具体操作如下（简略步骤），清华数据集刺激频率、相位信息如下![avatar](https://upload-images.jianshu.io/upload_images/19531862-b15dfa4fac75292b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)：

* 数据基础： 清华数据集的数据结构如下：$$DATA=N_{chan},N_{sample},N_{trial},N_{block}$$根据该数据结构，该数据集中每个被试的数据包含6个轮次，每轮次的实验包括40个刺激，即将所有刺激遍历一遍，每个刺激的有效刺激长度为4s，数据集内给出的每个试次数据长度为5s，因为包含了前后0.5s的静息状态。
  
* 目标：用相位平移的方法，截取出一个数据新的数据集，以模拟连续闪烁SSVEP的数据。具体方法如下。

* 对于某一特定刺激，如8Hz，在任一被试的数据集中可以找到6个样本（matlab可以用（:,:,1,1:6）)索引出这6个样本，每个样本有4s的数据时长，我们要**通过相位平移的手段，从这4s的数据中截取出若干个时长为t的、初相位相等的**刺激片段。假设能截取出n个片段，则每个试次能得到一个（：,:,1，n）的矩阵，那么将6个轮次的数据堆叠（这里用cat）可以得到（:,:,1,6n)形状的数据。

* 相位平移要按照High Speed和Benchmark中相位平移的方法来，注意，对于同一段信号，为了保证信号的连续性，要从左往右截取，先将信号向左平移至0相位，再向左平移出指定的相位。截取一段信号后，再将剩余信号平移为0相位，接着再平移到指定相位，截取出连续**5个**刺激片段。刺激片段的时长可以先设置为**0.4s**。

* 选取一组频率值（12个），尽量是等间隔，同时频率间隔尽量大，然后确定每一个频率对应的初相值，**方便起见，可以将相位间隔也确定为等间隔的**，如0.35pi。

* 这样，每个人都能得到一组数据，形状为（：,:,12,6n)，**注意12对应12个不同的频率，每个频率对应的相位应该是不同的，初相值要记录好！**

## 3 效果评价

最终应能通过网格搜索策略选定一组频率值（频率间隔）和相位间隔，评价指标为分类正确率和ITR。

## 4 备注

结合两篇论文和这个文档把问题思考清楚，想清楚过程，再开始编程，文档可能有疏漏，欢迎指出~